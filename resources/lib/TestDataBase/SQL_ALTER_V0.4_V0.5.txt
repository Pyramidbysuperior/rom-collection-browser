

ALTER TABLE RomCollection ADD COLUMN [searchGameByCRC] INTEGER;
ALTER TABLE RomCollection ADD COLUMN [searchGameByCRCIgnoreRomName] INTEGER;
ALTER TABLE RomCollection ADD COLUMN [ignoreGameWithoutDesc] INTEGER;

UPDATE RomCollection SET searchGameByCRC = 'True';
UPDATE RomCollection SET searchGameByCRCIgnoreRomName = 'False';
UPDATE RomCollection SET ignoreGameWithoutDesc = 'True';


ALTER TABLE FileType ADD COLUMN [type] TEXT;
ALTER TABLE FileType ADD COLUMN [parent] TEXT;

UPDATE FileType SET type = 'image' WHERE name NOT LIKE 'video%';
UPDATE FileType SET type = 'video' WHERE name LIKE 'video%';
UPDATE FileType SET parent = 'game';
UPDATE FileType SET name = 'gameplay' WHERE name = 'video_gameplay';

ALTER TABLE Game ADD COLUMN [originalTitle] TEXT;
ALTER TABLE Game ADD COLUMN [alternateTitle] TEXT;
ALTER TABLE Game ADD COLUMN [translatedBy] TEXT;
ALTER TABLE Game ADD COLUMN [version] TEXT;


DROP TABLE IF EXISTS File_tmp;

ALTER TABLE File RENAME TO File_tmp;

CREATE TABLE IF NOT EXISTS [File] 
(
    [id] INTEGER PRIMARY KEY AUTOINCREMENT,
    [name] TEXT NOT NULL,
    [fileTypeId] INTEGER NOT NULL REFERENCES [FileTypes]
    (
        id
    ),
    [parentId] INTEGER
);

INSERT INTO File(id, name, fileTypeId, parentId)
SELECT id, name, fileTypeId, gameId
FROM File_tmp;


UPDATE RCBSetting SET dbVersion = 'V0.5';
